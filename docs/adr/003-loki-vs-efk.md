# ADR-003: 중앙 로깅 시스템으로 Loki Stack 채택

**날짜**: 2025-10-01

---

## 상황 (Context)

마이크로서비스 환경에서는 로그가 여러 Pod에 분산되어 발생하므로, 장애 추적 및 디버깅을 위해 모든 로그를 한 곳에서 효율적으로 수집하고 검색할 수 있는 중앙 로깅 시스템이 필수적입니다. Prometheus(메트릭)와 Jaeger(추적)와 함께 관측성(Observability)을 만족해야 합니다.

## 결정 (Decision)

- 중앙 로깅 시스템으로 **Loki, Promtail, Grafana (PLG Stack)** 구성을 채택

## 이유 (Rationale)

EFK(Elasticsearch, Fluentd, Kibana) Stack과 Grafana Labs에서 개발한 Loki Stack을 비교했습니다.

### 비교 분석

| 기준 | Grafana Loki | ELK/EFK Stack | 선택 이유 |
|:---|:---|:---|:---|
| **아키텍처 복잡도** | **단순함** (Promtail, Loki) | 복잡함 (Fluentd, Elasticsearch, Kibana) | Loki는 로그 내용을 전체 인덱싱하지 않고 메타데이터(라벨)만 인덱싱하여 구조가 매우 가볍고 리소스 소모가 적습니다. |
| **시각화 도구 통합** | **Grafana와 네이티브 통합** | Kibana (별도 UI) | 이미 메트릭 모니터링을 위해 Grafana를 사용하고 있으므로, 별도의 UI 학습 없이 동일한 대시보드에서 로그와 메트릭을 함께 볼 수 있습니다. |
| **리소스 사용량** | **낮음** | 높음 | 1인 프로젝트의 제한된 리소스에 더 적합합니다. |

### 최종 선택 이유

**Grafana와의 네이티브 통합**과 **Prometheus와 유사한 사용자 경험(라벨 기반)**이 결정적인 장점이었습니다. 하나의 대시보드에서 특정 Pod의 CPU 사용량 급증(메트릭)을 확인하고, 즉시 동일한 라벨을 가진 해당 Pod의 에러 로그(로그)를 조회하는 매끄러운 워크플로우를 구축할 수 있습니다. 이는 EFK Stack에서 Kibana와 Grafana를 오가며 작업하는 것보다 훨씬 효율적입니다.

## 결과 (Consequences)

### 긍정적 측면
-   메트릭과 로그를 Grafana라는 단일 인터페이스에서 통합적으로 조회하고 분석할 수 있게 됨.
-   Prometheus와 동일한 라벨 시스템을 사용하여 메트릭과 로그를 쉽게 연관시킬 수 있음.
-   가벼운 아키텍처 덕분에 제한된 클러스터 리소스 내에서 효율적으로 로깅 시스템을 운영할 수 있음.

### 부정적 측면 (Trade-offs)
-   Loki는 로그 전체를 인덱싱하지 않으므로, 로그 내용 자체에 대한 복잡한 전문(full-text) 검색 성능은 Elasticsearch에 비해 떨어질 수 있다. 하지만 라벨 기반의 필터링으로 대부분의 디버깅 시나리오를 충분히 커버할 수 있다.